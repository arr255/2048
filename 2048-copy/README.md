copy过来的，基本看明白了，并添加了大量注释和完善了一些内容
